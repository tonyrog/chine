%% -*- erlang -*-
{export, println}.
{export, print}.
{export, uprint}.
{export, putc}.
{export, puts}.

%% PUTC: ( c -- )
{function, [], putc, [c], [],
 [
  c,emit
]}.

%% PUTS: ( cptr -- )
{function, [], puts, [arr], [i],
 [
  {op,':=',i,0},
  {'while', [arr,i,'[]',dup],
   [emit,
    {op, ':=', i, {op, '+', i, 1}}
   ]}
]}.

%% PRINTLN: ( n -- )
{function, [], println, [n], [],
 [
  {call,print, [n]},
  $\n,emit
]}.

%% PRINT: ( n -- )
{function, [], print, [n], [],
 [
  {'if', {op,'==',n,0}, [$0,emit],
   {'if', {op,'<',n,0}, [$-,emit, {call,uprint,[{op,negate,n}]}],
    {call,uprint,[n]}}}
 ]}.

%% UPRINT: ( n -- ) n>=0
{function, [], uprint, [n], [],
 [
  {'if', {op,'>',n,0}, 
   [{call,uprint,[{op,'/',n,10}]},
    {op,'+',{op,'mod',n,10},$0},emit
   ]}
 ]}.
